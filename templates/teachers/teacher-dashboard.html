{% extends 'Home/base.html' %}
{% load static %}
{% block body %}
<div class="page-wrapper">
   <div class="content container-fluid">
      <div class="page-header">
         <div class="row">
            <div class="col-sm-12">
               <h3 class="page-title">Teacher Dashboard</h3>
               <ul class="breadcrumb">
                  <li class="breadcrumb-item active">Overview</li>
               </ul>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-one w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-calendar-day"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ upcoming_classes|length }}</h3>
                        <h6>Upcoming Classes</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-two w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-check-circle"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ completed_count }}/{{ total_classes }}</h3>
                        <h6>Completed Classes</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-three w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-percent"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ coverage }}%</h3>
                        <h6>Avg. Coverage</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-four w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-users"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ total_students }}</h3>
                        <h6>Students</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-8 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Schedule</h5>
                  <a href="{% url 'teacher_schedules' %}" class="btn btn-sm btn-outline-primary">Update schedule</a>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-striped mb-0">
                        <thead>
                           <tr>
                              <th>Date</th>
                              <th>Topic</th>
                              <th>Class</th>
                              <th>Attendance</th>
                              <th>Status</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for schedule in upcoming_classes %}
                           <tr>
                              <td>{{ schedule.date|date:"M d" }} {{ schedule.start_time|time:"H:i" }}</td>
                              <td>{{ schedule.topic }}</td>
                              <td>{{ schedule.class_name }}</td>
                              <td>{{ schedule.present_students }}/{{ schedule.total_students }}</td>
                              <td><span class="badge badge-success text-uppercase">{{ schedule.status }}</span></td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="5" class="text-center text-muted">No classes scheduled.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-lg-4 d-flex">
            <div class="card flex-fill">
               <div class="card-header">
                  <h5 class="card-title mb-0">Profile</h5>
               </div>
               <div class="card-body">
                  <p class="mb-1"><strong>{{ profile.user.get_full_name|default:profile.user.username }}</strong></p>
                  <p class="text-muted">{{ profile.title|default:"Teacher" }} - {{ profile.subject_specialty|default:"Subject" }}</p>
                  <p class="mb-0">{{ profile.bio|default:"Keep your profile updated so the principal can see your expertise." }}</p>
                  <hr>
                  <p class="mb-1"><i class="fas fa-building mr-2"></i>{{ profile.department|default:"Department pending" }}</p>
                  <p class="mb-1"><i class="fas fa-phone mr-2"></i>{{ profile.phone|default:"Add contact" }}</p>
                  <a href="{% url 'teacher_profile' %}" class="btn btn-primary btn-block mt-3">Edit Profile</a>
               </div>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-6 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Recent Classes</h5>
                  <span class="text-muted small">Last 7 days</span>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-hover">
                        <thead>
                           <tr>
                              <th>Date</th>
                              <th>Topic</th>
                              <th>Coverage</th>
                              <th>Attendance</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for schedule in recent_history %}
                           <tr>
                              <td>{{ schedule.date|date:"M d" }}</td>
                              <td>{{ schedule.topic }}</td>
                              <td>{{ schedule.syllabus_coverage }}%</td>
                              <td>{{ schedule.present_students }}/{{ schedule.total_students }}</td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="4" class="text-center text-muted">No recent classes.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-lg-6 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Homework Tracker</h5>
                  <a href="{% url 'teacher_homework' %}" class="btn btn-sm btn-outline-primary">Manage</a>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-striped">
                        <thead>
                           <tr>
                              <th>Title</th>
                              <th>Class</th>
                              <th>Due</th>
                              <th>Status</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for homework in homework_list %}
                           <tr>
                              <td>{{ homework.title }}</td>
                              <td>{{ homework.class_name }}</td>
                              <td>{{ homework.due_date|date:"M d" }}</td>
                              <td><span class="badge badge-info text-uppercase">{{ homework.status }}</span></td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="4" class="text-center text-muted">No homework assigned.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-7 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Students Overview</h5>
                  <a href="{% url 'student_list' %}" class="btn btn-sm btn-outline-primary">Go to students</a>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-hover">
                        <thead>
                           <tr>
                              <th>ID</th>
                              <th>Name</th>
                              <th>Class</th>
                              <th>Guardian</th>
                              <th></th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for student in students %}
                           <tr>
                              <td>{{ student.student_id }}</td>
                              <td>{{ student.first_name }} {{ student.last_name }}</td>
                              <td>{{ student.student_class }} - {{ student.section }}</td>
                              <td>{{ student.parent.father_name }}</td>
                              <td class="text-right">
                                 <a href="{% url 'view_student' student.slug %}" class="btn btn-sm btn-outline-primary">Details</a>
                              </td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="5" class="text-center text-muted">No students found.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-lg-5 d-flex">
            <div class="card flex-fill">
               <div class="card-header">
                  <h5 class="card-title mb-0">Faculty Directory</h5>
               </div>
               <div class="card-body">
                  <ul class="teacher-list">
                     {% for teacher in other_teachers %}
                     <li class="teacher-item">
                        <h6 class="mb-1">{{ teacher.user.get_full_name|default:teacher.user.username }}</h6>
                        <p class="text-muted mb-0">{{ teacher.subject_specialty|default:"Subject" }} • {{ teacher.department|default:"Department" }}</p>
                     </li>
                     {% empty %}
                     <li class="text-muted">No other teachers listed yet.</li>
                     {% endfor %}
                  </ul>
               </div>
            </div>
         </div>
      </div>
   </div>
   <footer>
      <p>© {% now "Y" %} Teacher Workspace.</p>
   </footer>
</div>

<script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'assets/js/popper.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'assets/js/script.js' %}"></script>
{% endblock %}

