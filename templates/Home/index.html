{% extends 'Home/base.html' %}
{% load static %}
{% block body %}
<div class="page-wrapper">
   <div class="content container-fluid">
      <div class="page-header">
         <div class="row">
            <div class="col-sm-12">
               <h3 class="page-title">Welcome {{ user.first_name|default:"Admin" }}!</h3>
               <ul class="breadcrumb">
                  <li class="breadcrumb-item active">Admin Dashboard</li>
               </ul>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-one w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-user-graduate"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ student_count }}</h3>
                        <h6>Students</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-two w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ teacher_count }}</h3>
                        <h6>Teachers</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-three w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-calendar-check"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ total_classes }}</h3>
                        <h6>Classes Scheduled</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-xl-3 col-sm-6 col-12 d-flex">
            <div class="card bg-four w-100">
               <div class="card-body">
                  <div class="db-widgets d-flex justify-content-between align-items-center">
                     <div class="db-icon">
                        <i class="fas fa-chart-pie"></i>
                     </div>
                     <div class="db-info">
                        <h3>{{ coverage }}%</h3>
                        <h6>Syllabus Coverage</h6>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-7 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Upcoming Classes</h5>
                  <a href="{% url 'teacher_schedules' %}" class="btn btn-sm btn-outline-primary">Manage schedules</a>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-hover mb-0">
                        <thead>
                           <tr>
                              <th>Date</th>
                              <th>Class</th>
                              <th>Topic</th>
                              <th>Teacher</th>
                              <th>Attendance</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for schedule in upcoming_classes %}
                           <tr>
                              <td>{{ schedule.date|date:"M d" }} {{ schedule.start_time|time:"H:i" }}</td>
                              <td>{{ schedule.class_name }}</td>
                              <td>{{ schedule.topic }}</td>
                              <td>{{ schedule.teacher.get_full_name|default:schedule.teacher.username }}</td>
                              <td>{{ schedule.present_students }}/{{ schedule.total_students }}</td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="5" class="text-center text-muted">No classes scheduled.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-lg-5 d-flex">
            <div class="card flex-fill">
               <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="card-title mb-0">Homework Pipeline</h5>
                  <a href="{% url 'teacher_homework' %}" class="btn btn-sm btn-outline-primary">View homework</a>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-striped mb-0">
                        <thead>
                           <tr>
                              <th>Due</th>
                              <th>Title</th>
                              <th>Class</th>
                              <th>Status</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for item in homework_queue %}
                           <tr>
                              <td>{{ item.due_date|date:"M d" }}</td>
                              <td>{{ item.title }}</td>
                              <td>{{ item.class_name }}</td>
                              <td><span class="badge badge-info text-uppercase">{{ item.status }}</span></td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="4" class="text-center text-muted">No homework assigned.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="row">
         <div class="col-lg-5 d-flex">
            <div class="card flex-fill">
               <div class="card-header">
                  <h5 class="card-title mb-0">Teacher Spotlight</h5>
               </div>
               <div class="card-body">
                  <ul class="teacher-list">
                     {% for teacher in teacher_profiles %}
                     <li class="teacher-item d-flex justify-content-between">
                        <div>
                           <h6 class="mb-1">{{ teacher.user.get_full_name|default:teacher.user.username }}</h6>
                           <p class="text-muted mb-0">{{ teacher.subject_specialty|default:"Subject Lead" }}</p>
                        </div>
                        <span class="badge badge-light">{{ teacher.experience_years }} yrs</span>
                     </li>
                     {% empty %}
                     <li class="text-muted">No teacher profiles yet.</li>
                     {% endfor %}
                  </ul>
               </div>
            </div>
         </div>
         <div class="col-lg-7 d-flex">
            <div class="card flex-fill">
               <div class="card-header">
                  <h5 class="card-title mb-0">Recently Added Students</h5>
               </div>
               <div class="card-body">
                  <div class="table-responsive">
                     <table class="table table-hover">
                        <thead>
                           <tr>
                              <th>ID</th>
                              <th>Name</th>
                              <th>Class</th>
                              <th>Joined</th>
                              <th></th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for student in recent_students %}
                           <tr>
                              <td>{{ student.student_id }}</td>
                              <td>{{ student.first_name }} {{ student.last_name }}</td>
                              <td>{{ student.student_class }} - {{ student.section }}</td>
                              <td>{{ student.joining_date|date:"M d, Y" }}</td>
                              <td class="text-right">
                                 <a href="{% url 'view_student' student.slug %}" class="btn btn-sm btn-outline-primary">View</a>
                              </td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td colspan="5" class="text-center text-muted">No students available.</td>
                           </tr>
                           {% endfor %}
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <footer>
      <p>Â© {% now "Y" %} SMS Admin Workspace.</p>
   </footer>
</div>

<script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'assets/js/popper.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'assets/js/script.js' %}"></script>
{% endblock %}

